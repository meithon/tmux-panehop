#!/usr/bin/env bash

# A fzf-based tmux pane switcher plugin script
# Lists all tmux panes across sessions, previews pane contents, and allows killing panes with Ctrl-X

RELOAD_CMD='tmux list-panes -a -F "#{session_name}:#{window_index}.#{pane_index} #{pane_id}"'

# Launch fzf-tmux with preview and kill-pane binding
eval "$RELOAD_CMD" | \
  fzf-tmux -p \
    --layout=reverse \
    --preview 'tmux capture-pane -pe -t {2}' \
    -w 60% \
    -h 80% \
    --border \
    --preview-window up:90% \
    --bind "ctrl-x:execute(tmux kill-pane -t {2}; $RELOAD_CMD > /dev/tty)+reload($RELOAD_CMD)" | \
  awk '{print $2}' | \
  xargs tmux switch-client -t
